---
layout: post
title: "家中网络问题一则"
categories: network
description: 家中网络问题一则
tags: Router BananaPi
---

某天早上起来，发现屋里手机、电脑都上不了网了，照惯例先后重启了一下路由器和WIFI中继，都不管用，感觉问题有点严重了。

屋里的网络拓扑如图所示，略显繁杂：

![Network topo at home](http://www.plantuml.com/plantuml/svg/UDfjL4rlsp0ClUjNyBODMDeaGzjBKJHfCQn04nX9W0uOTf1jeYOiIuQa9Cs_7nr_Z6vhNyZtw4VgYSbzYDh7VMMK2YNPMdjTWNKvhdM52qEl5ZAq4RsW2stpewSOqKBqUnHKf6XmwNoEVkFsDdzmtgA7sTNdDRk2ij9Y233xlE316USXDJehrHc6DSQZyoL4LplG4GfNeL9hdXYUjWdyKRVf7GUtb-cT-jlYIstvJOZ9DWIEDpFWIXwIptOklk17VNqaRLYxqVeEgKTTmb4RywtNsYNFPCljaM9MiDukcJGvpARJwQeHR1afYMyrsXo6pby2OEGAYn5gvsFefJSwr2bwVqfelcJj8M_6dIzRjKM0NxlauNAzsB9CTZ5yVFrZEZtC-JCsw1MrRn4up5NjtO6uXATxUVhvr4m6cQvrIeRYgPKblia28V2badq5xrpLAx-GpTqnF68esNDka7THfRE2BBO2NHNS05bUAMCmxmLMEbkHfI59dIiNvAMV6pJw9EoKevwvqPGfvd90IWfdyJh8x6h8TFw_-HhVzk6wZN-JTXNrTRo8jgnrljEfmTZO-8pM7Tn0GCTmqtwT9fDcqPJS28PwLdKtmf2iKADRVayADvZg5DJu1WJHEJj6Edi5-EvmWkcj-m1TZQ7MH06rJWgWj_DpSN4ksM0C3qqaF3IIe6WcuT7X9V7H0CcgU_vzyZ_WFuJffP00)

大多数情况下，都是R6300v2这个二级路由器不稳定，时不时WIFI连不上了，重启就好了，也遇到过TP-Link的WIFI中继不工作的情况，也是重启就好了。一般情况下我是不愿意重启用于拨号和翻墙的作为一级路由器的Banana Pi R1的，因为翻墙部分的程序有时候在板子起来后并不能自动运行，要ssh登录上去后手工输入命令运行起来，挺嫌麻烦的。这回只好把Banana Pi也重启了一下，结果居然也没用！

最后只能把目标转移到TP-Link千兆交换机上了，重启后问题仍然存在。偶然试了一下把R6300v2的WAN口网线从交换机上拔下，插到Banana Pi上，居然全都能访问网络。在我看来似乎是交换机坏掉了，既然Banana Pi上有4个LAN口，把Raspberry Pi也插到Banana Pi上也不是不能接受。然后我就上班去了，似乎一切正常了。

晚上下班回家，发现用电脑访问不了Raspberry Pi了，但是电脑可以访问Banana Pi，从Banana Pi可以访问到Raspberry Pi。然后发现Raspberry Pi和R6300v2互相不能访问，连ping都ping不通，但两者与Banana Pi却都可以互相访问。无论怎么重启Raspberry Pi（uptime已经达到389天！）和R6300v2都没用。

到SHLUG的微信群里问了一下，没人能说清什么原因。

想来想去，觉得问题似乎就是Banana Pi下的设备数据交换功能出问题了。抱着试试看的想法，把TP-Link交换机又接了回去，只是Raspberry Pi和R6300v2换了其他的网口插在交换机（8口）上，一切竟然全都恢复正常了！看来Banana Pi上的4个LAN口并不像平常的交换机那样呢，有点坑。