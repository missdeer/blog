---
layout: post
title: "写程序是件很诡异的事"
categories:
- WIND
tags: []
status: publish
type: post
published: true
meta:
  blogger_blog: missdeer.blogspot.com
  blogger_author: missdeerhttp://www.blogger.com/profile/18003139432457999590noreply@blogger.com
  blogger_permalink: "/2009/07/blog-post_30.html"
author:
  login: missdeer
  email: missdeerme@163.com
  display_name: missdeer
  first_name: "樊"
  last_name: "杨"
---
<p>　　上午花了两个多小时，嗯，确实是两个多小时，写了个小程序，每隔一段时间扫描一下指定的文件夹下所有core dump文件，和历史数据库中的记录进行比较，如果历史数据库中没有记录，则认为是新追加的文件，一边将其添加到历史数据库中，一边则使用cdb.exe通过命令行进行分析，最后将分析结果连同那个core dump文件一起通过SMTP协议发送到notes邮箱中。<br />　　其中遇到不少奇怪的问题。本来是打算cdb.exe将分析结果重定向到文件后，自己读一下这个文件的内容，把这个内容作为邮件的正文发送的。结果首先是发现，使用system这个CRT函数，其中是调用了cmd.exe /c这个命令行，所以如果传给这个函数的参数如果同间有空格，是要用双引号包括起来的。尤其要注意的是，如果打算执行的是一个带参数的命令行，得从头到尾一起括起来。接着我就想用ifstream的方式把文件内容读出来，然而很诡异的是，直接将其输入到一个stringstream时，只有一小部分内容读出来了；通过getline一行一行读出来后，本来打算全部追加到另一个string中去的，但是就是追加不进去，最后想使用API吧，直接CreateFile，再ReadFile，内容但是全读出来了，最后通过SMTP发送这部分正文时，依旧只能发送前面一小部分。放弃了，本来就昆个Quick &amp; Dirty的东西，于是还是直接把这个文本文件作为附件发送吧。也不知道是不是那个SMTP类本来就有问题，运行的过程中时不时弹出个出错信息来，什么delete指针时错了呀，堆被破坏了呀，等等等等，不一而足，实在无语得很！<br />　　不过尽管还是会弹错误框，但手工点一下也不麻烦，先这么着吧，至少可以当成一个监视器用了。<br />　　这两天我一直在想一个问题：是不是mini dump只有一个用途——!analyze -v？没有找到答案，但翻遍所有的能找到的参考资料，似乎这个猜想是真的！</p>
