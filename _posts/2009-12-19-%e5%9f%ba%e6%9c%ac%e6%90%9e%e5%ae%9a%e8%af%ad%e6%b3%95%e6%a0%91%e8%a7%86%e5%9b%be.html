---
layout: post
title: "基本搞定语法树视图"
categories:
- CodingStudio
---
<p>　　今天在宿主程序中做了修改，并添加了插件，可以在适当的时候触发刷新语法树视图。<br />　　刷新语法树的时机其实并不好选择，总的说来，应该在这两个时刻进行刷新：一，文档刚刚打开；二，做出了影响语法树内容的修改。第一点，比较容易做到，但第二点就比较困难了，它包括当前活动文档的切换，以及当前活动文档被修改。切换也是比较容易响应的，但怎样判断一个修改是否影响了语法树内容，就不简单了。我现在的简单做法是，每当有新的行时，就进行刷新，笨了点，但勉强能用。<br />　　刷新语法树的方式，也是需要仔细实现的，我现在的做法完全是为了简单起见，先停止刷新窗口，然后清空整个树，再把整个树的内容都重新添加一遍，再刷新窗口。这样的缺点是在刷新时，能明显地看到整个树视图的闪烁。如果要规避这个问题，应该比较当前树视图中的内容和待刷新的数据，在树视图中逐个判断有新增的，或需要删除的节点，这样就比较流畅了。但这个算法就相对来说复杂，而且可能更耗资源。<br />　　目前我只是让Lua中的函数定义作为语法树视图中的唯一的元素，目前看来效果还可以。其实单就Lua来讲，还可以添加变量的定义以及表的构造。但是眼前可以预见的问题是，变量可能有很多，全列出来可能干扰视线。而表的构造表达方式可以很复杂，而且表是可以在程序中动态增删元素的，这要如何处理。</p>
