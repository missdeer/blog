---
layout: post
title: "图形程序设计续之自动调整连接点"
categories: []
tags: []
status: publish
type: post
published: true
meta:
  blogger_blog: missdeer.blogspot.com
  blogger_author: missdeerhttp://www.blogger.com/profile/18003139432457999590noreply@blogger.com
  blogger_permalink: "/2009/09/blog-post_1344.html"
author: 
---
<p>　　本来计划是明天才开始做这个功能的，不过因为着急着要尽快走流程办手续，只好把这最主要的任务尽早实现了。<br />　　总的说来，基本算法是完成了，不过还是有些小bug。大体的算法是这样的：三类连接线，包括折线，样本曲线和贝塞尔曲线，其中两种曲线要都Flatten一下，最后变成一组前后相连的线段，然后将这组线段分别与矩形的4条边计算交点，把离交点最近的跟踪点作为新的连接线的一个端点。<br />　　这里要注意的是计算交点的顺序问题。也就是说，如果是从连在矩形上的端点开始遍历那组线段来计算交点，那么应该以最后一次的交点作为最终结果。而如果是从另一个端点开始遍历计算交点，那么应该以第一次的交点作为最终结果。<br />　　其次是中间点的调整。像折线，一个比较简单的做法，把交点与端点间的所有连接点都删掉就可以了。而样本曲线则应该调整中间的切点位置，贝塞尔曲线则是调整两个控制点的位置，以免新生成的曲线因为中间那些点的牵引而仍然横穿矩形。</p>
